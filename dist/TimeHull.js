"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function _createClass(t,i,n){return i&&_defineProperties(t.prototype,i),n&&_defineProperties(t,n),t}var areaPolygon=require("area-polygon"),hull=require("hull.js"),TimeHull=function(){function h(t){var i=this;_classCallCheck(this,h);var n=t||{},e=n.seriesPoints,s=n.width,o=n.height,r=n.startIndex,a=n.endIndex;if(void 0===e||!e.length)throw new Error("noSeriesPoints");this.seriesPoints=function(){return e},this.width=s||0,this.height=o||0,this.startIndex=r||0,this.endIndex=a||e.length-1,this.points=this.getSlicedPoints(),this.name=this.endTime(),this.duration=function(){return e[i.endIndex+1]?e[i.endIndex+1].timestamp-i.endTime():0}}return _createClass(h,[{key:"area",value:function(t){var i=t&&t.points||this.points,n=h.distinctPoints(this.polygon({points:i}));return n.length<3?0:areaPolygon(n)}},{key:"azimuth",value:function(){var t;if(this.points&&1<this.points.length){var i=this.points[this.points.length-2],n=this.points[this.points.length-1];i.x===n.x&&i.y===n.y?t=0:(t=90-180*Math.atan2(n.y-i.y,n.x-i.x)/Math.PI,t<0&&(t+=360))}return t}},{key:"centroid",value:function(t){var i,n=(t||{}).which,e=(t||{}).points;if(1===(e=e||this.points).length&&(i={x:e[0].x,y:e[0].y}),2===e.length&&(i={x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2}),2<e.length){var s=h.distinctPoints(this.polygon({points:e}));i=h.calculateCentroid(s)}return void 0!==n&&void 0!==i?i[n]:i}},{key:"coverage",value:function(t){var i=t&&t.points||this.points,n=t&&t.width||this.width,e=t&&t.height||this.height,s=this.area({points:i});if(0===s)return 0;if(n*e==0)throw new Error("noStimulusArea");return s/(n*e)}},{key:"coverageDuration",value:function(t){return this.coverage(t)*this.duration()}},{key:"coveragePercent",value:function(t){var i=t&&t.points||this.points;return 100*this.coverage({points:i})}},{key:"distance",value:function(t){return void 0!==t?this.points&&1<this.points.length?this.points[this.points.length-1][t]-this.points[this.points.length-2][t]:0:Math.sqrt(this.distance("x")*this.distance("x")+this.distance("y")*this.distance("y"))}},{key:"elapsedTime",value:function(){return this.endTime()-this.seriesPoints()[0].timestamp}},{key:"endTime",value:function(){return this.points[this.points.length-1].timestamp}},{key:"getPoints",value:function(i){return void 0!==i?this.points.map(function(t){return t[i]}):this.points}},{key:"getSlicedPoints",value:function(i){var t=this.seriesPoints().slice(this.startIndex,this.endIndex+1);return void 0!==i?t.map(function(t){return t[i]}):t}},{key:"lastPoint",value:function(){return this.points[this.points.length-1]}},{key:"period",value:function(){return this.endTime()-this.startTime()}},{key:"polygon",value:function(t){var i=t&&t.points||this.points,n=(t||{}).which,e=hull(h.XYToCoordinates(i),1/0);return e=h.coordinatesToXY(e),void 0!==n?e.map(function(t){return t[n]}):e}},{key:"startTime",value:function(){return this.points[0].timestamp}},{key:"timestep",value:function(){return this.points&&1<this.points.length?this.points[this.points.length-1].timestamp-this.points[this.points.length-2].timestamp:0}},{key:"velocity",value:function(t){return 0<this.timestep()&&0<this.distance()?this.distance(t)/this.timestep():0}}],[{key:"calculateCentroid",value:function(t){var i=t.slice();if(1===i.length)return{x:i[0].x,y:i[0].y};var n=i[0],e=i[i.length-1];n.x===e.x&&n.y===e.y||i.push(n);for(var s,o,r,a=0,h=0,u=0,l=i.length,c=0,p=l-1;c<l;c+=1)s=i[c],o=i[p],a+=r=s.x*o.y-o.x*s.y,h+=(s.x+o.x)*r,u+=(s.y+o.y)*r,p=c;return{x:h/(r=3*a),y:u/r}}},{key:"coordinatesToXY",value:function(t){return t.map(function(t){return{x:t[0],y:t[1]}})}},{key:"distinctPoints",value:function(n){for(var t=[],i=function(i){t.findIndex(function(t){return t.x===n[i].x&&t.y===n[i].y})<0&&t.push(n[i])},e=0;e<n.length;e+=1)i(e);return t}},{key:"XYToCoordinates",value:function(t){return t.map(function(t){return[t.x,t.y]})}}]),h}();module.exports=TimeHull;