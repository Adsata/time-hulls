"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var _require=require("jStat"),jStat=_require.jStat,TimeHull=require("./TimeHull"),TimeHullSeries=function(){function h(t){_classCallCheck(this,h);var e=t||{},i=e.points,r=e.period,n=e.timestep,s=e.includeIncomplete,o=e.width,u=e.height;if(void 0===i||!i.length)throw new Error("noPoints");if(i.length<3)throw new Error("tooFewPoints");if(void 0===r)throw new Error("noPeriod");this.points=i.sort(function(t,e){return t.timestamp-e.timestamp}),this.period=r,this.timestep=n||0,this.includeIncomplete=s||!1,this.width=o||0,this.height=u||0}return _createClass(h,[{key:"getAverageCoverage",value:function(){if(void 0===this.averageCoverage){var t=this.getHulls(),e=t.map(function(t){return t.coverageDuration()}),i=t.map(function(t){return t.duration()}),r=0;0<jStat.sum(i)&&(r=jStat.sum(e)/jStat.sum(i)),this.averageCoverage=r}return this.averageCoverage}},{key:"getCentroids",value:function(t){var e,i=(t||{}).which;try{e=this.getHull(t)}catch(t){if("noHullSpecified"===t.message){var r=this.getHulls();e=r[r.length-1]}}this.centroids||(this.centroids=this.getHulls().map(function(t){return t.centroid()}));var n=this.centroids.slice(0,e.number);return void 0!==i?n.map(function(t){return t[i]}):n}},{key:"getDuration",value:function(){return void 0===this.duration&&(this.duration=this.points[this.points.length-1].timestamp-this.points[0].timestamp),this.duration}},{key:"getEndPointIndex",value:function(t){if(!this.points[t])throw new Error("startIndexOutOfBounds");for(var e=this.points[t].timestamp,i=t,r=0;r<this.period;){if(i+=1,!this.points[i])return;r=this.points[i].timestamp-e}return r===this.period?i:i-1}},{key:"getEndTime",value:function(){return this.getHulls()[this.getHulls().length-1].endTime()}},{key:"getHull",value:function(t){var e=(t||{}).hullIndex,i=(t||{}).hull;if(void 0===i&&void 0===e)throw new Error("noHullSpecified");if(!i){if("number"!=typeof e)throw new Error("invalidHullIndex");var r=this.getHulls();if(!r[e])throw new Error("hullIndexOutOfBounds");i=r[e]}if("TimeHull"!==i.constructor.name)throw new Error("invalidHull");return i}},{key:"getHulls",value:function(){if(void 0===this.hulls){for(var t,e,i=[],r=this.points.length-1,n=this.points.length-1;0<=n&&1<r;r-=1)if(void 0===(n=this.getStartPointIndex(r))&&(this.includeIncomplete||0<e)&&(n=0),0<=n&&(e=n,void 0===t||this.points[t].timestamp-this.points[r].timestamp>=this.timestep)){t=r;var s=new TimeHull({series:this,seriesPoints:this.points,startIndex:n,endIndex:r,width:this.width,height:this.height});i.push(s)}i.reverse();for(var o=0;o<i.length;o+=1)i[o].number=o+1;this.hulls=i}return this.hulls}},{key:"getStartPointIndex",value:function(t){if(!this.points[t])throw new Error("endIndexOutOfBounds");for(var e=this.points[t].timestamp,i=t,r=0;r<this.period&&(i-=1,this.points[i]);){r=e-this.points[i].timestamp}return r===this.period?i:r>this.period?i+1:void 0}},{key:"getStartTime",value:function(){return this.getHulls()[0].startTime()}}]),h}();module.exports=TimeHullSeries;